import{o as B,R as j,v as A,u as C,r as n,j as e,P as G}from"./vendor.761b0733.js";import{u as $,a as M,F as Q,v as Y,Q as q,R as z,E as H}from"./ExtraForm.abac9246.js";import{F as X}from"./Form.f9dd27f5.js";import{B as b}from"./Button.b639cc19.js";import{a as J,u as K,b as D,c as E}from"./index.fb8ab378.js";import{u as L}from"./useNavbar.e0798357.js";import"./warning.b33cdbd2.js";import"./Col.48c55a83.js";var a="C:\\Projects\\f1predictions-ui\\src\\pages\\PredictionForm.jsx";const te=()=>{const{t:m}=B(),[f,u]=j.useState(!1),[i,N]=j.useState(0),{id:p}=A(),{push:c,goBack:x}=C(),{dispatch:y}=J(),{data:o,loading:h}=K(`${D}/${p}`);n.exports.useEffect(()=>{o&&new Date(o.qualifying_start_timestamp)<new Date&&(y({type:"NOTIFY",payload:{id:new Date().getTime(),text:"Grand Prix has already passed",delay:5e3,type:"danger"}}),c("/"))},[o]);const V=n.exports.useMemo(()=>({leftAction:x,leftActionIcon:"fa-arrow-left",showBottomNav:!1}),[x]);L(V);const{fetch:T,loading:v}=$(),{fetch:P,loading:g}=M();async function w(t){return o?.user_prediction?await P(E+`/${o.user_prediction.id}`,{result_entries:Object.entries(t).map(([s,l])=>({name:s,driver_id:l}))}).then(()=>c("/")):await T(D+`/${p}`+E,{prediction_entries:Object.entries(t).map(([s,l])=>({name:s,driver_id:l}))}).then(()=>c("/"))}async function _(t){const s=await t();Object.keys(s).length<=0?(N(i+1),u(!1)):u(!0)}function F(){N(i-1)}const r=n.exports.useMemo(()=>h||v||g,[h,v,g]),S=n.exports.useMemo(()=>o?.user_prediction?o.user_prediction.prediction_entries.reduce((t,s)=>({...t,[s.name]:s.driver.id}),{}):{},[o]);return e.exports.jsxDEV("div",{className:"form-container",children:e.exports.jsxDEV(Q,{validationSchema:Y[i],validateOnChange:f,validateOnBlur:f,initialValues:S,onSubmit:w,enableReinitialize:!0,children:({handleSubmit:t,handleChange:s,values:l,errors:d,validateForm:I,dirty:R,submitCount:k})=>e.exports.jsxDEV(e.exports.Fragment,{children:[e.exports.jsxDEV(G,{when:R&&k<1,message:"You have unsaved changes, are you sure you want to leave?"},void 0,!1,{fileName:a,lineNumber:105,columnNumber:19},globalThis),e.exports.jsxDEV(X,{noValidate:!0,onSubmit:O=>{O.preventDefault(),t(),u(!0)},children:[i===0&&e.exports.jsxDEV(q,{handleChange:s,errors:d,values:l,disabled:r},void 0,!1,{fileName:a,lineNumber:114,columnNumber:42},globalThis),i===1&&e.exports.jsxDEV(z,{handleChange:s,errors:d,values:l,disabled:r},void 0,!1,{fileName:a,lineNumber:115,columnNumber:42},globalThis),i===2&&e.exports.jsxDEV(H,{handleChange:s,errors:d,values:l,disabled:r},void 0,!1,{fileName:a,lineNumber:116,columnNumber:42},globalThis),e.exports.jsxDEV("div",{className:"d-flex py-3 w-10 position-sticky bg-white gap-4",style:{bottom:0},children:[i!==0&&e.exports.jsxDEV(b,{onClick:F,variant:"outline-primary",type:"button",className:"col-xs text-nowrap",disabled:r,children:[e.exports.jsxDEV("i",{className:"fas fa-arrow-left"},void 0,!1,{fileName:a,lineNumber:127,columnNumber:31},globalThis),e.exports.jsxDEV("span",{className:"ms-3",children:m("global.back")},void 0,!1,{fileName:a,lineNumber:128,columnNumber:31},globalThis)]},void 0,!0,{fileName:a,lineNumber:120,columnNumber:28},globalThis),i<2&&e.exports.jsxDEV(b,{onClick:()=>_(I),variant:"primary",type:"button",className:"col text-nowrap",disabled:r,children:[e.exports.jsxDEV("span",{className:"me-3",children:m("global.next")},void 0,!1,{fileName:a,lineNumber:139,columnNumber:31},globalThis),e.exports.jsxDEV("i",{className:"fas fa-arrow-right"},void 0,!1,{fileName:a,lineNumber:140,columnNumber:31},globalThis)]},void 0,!0,{fileName:a,lineNumber:132,columnNumber:28},globalThis),i===2&&e.exports.jsxDEV(b,{variant:"primary",type:"submit",className:"col",disabled:r,children:[e.exports.jsxDEV("span",{className:"me-3",children:m("global.save")},void 0,!1,{fileName:a,lineNumber:145,columnNumber:31},globalThis),e.exports.jsxDEV("i",{className:"fas fa-save"},void 0,!1,{fileName:a,lineNumber:146,columnNumber:31},globalThis)]},void 0,!0,{fileName:a,lineNumber:144,columnNumber:28},globalThis)]},void 0,!0,{fileName:a,lineNumber:118,columnNumber:22},globalThis)]},void 0,!0,{fileName:a,lineNumber:106,columnNumber:19},globalThis)]},void 0,!0)},void 0,!1,{fileName:a,lineNumber:95,columnNumber:10},globalThis)},void 0,!1,{fileName:a,lineNumber:94,columnNumber:7},globalThis)};export{te as default};
