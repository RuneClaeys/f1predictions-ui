import{u as B,R as y,v as A,c as C,r as u,j as e,P as G}from"./vendor.855a4921.js";import{u as Y,a as $,F as M,v as q,Q,R as z,E as H}from"./ExtraForm.6ccc7fef.js";import{F as U}from"./Form.636858ef.js";import{B as f}from"./Button.10f28fc7.js";import{a as X,u as J,b as D,c as T}from"./index.aefdac3f.js";import{u as K}from"./useNavbar.384d71f9.js";import{d as L}from"./index.970aea1b.js";import"./warning.b33cdbd2.js";import"./Col.fc6e8593.js";var a="C:\\Users\\runec\\Documents\\Projects\\f1predictions-ui\\src\\pages\\PredictionForm.jsx";const re=()=>{const{t:n}=B(),[p,c]=y.useState(!1),[t,N]=y.useState(0),{id:x}=A(),{push:m,goBack:g}=C(),{dispatch:d}=X(),{data:s,loading:h}=J(`${D}/${x}`);u.exports.useEffect(()=>{s&&new Date(s.qualifying_start_timestamp)<new Date&&(d({type:"NOTIFY",payload:{id:new Date().getTime(),text:"Grand Prix has already passed",delay:5e3,type:"danger"}}),m("/")),s&&L(s.qualifying_start_timestamp,new Date)>3&&m("/")},[s]);const E=u.exports.useMemo(()=>({leftAction:g,leftActionIcon:"fa-arrow-left",showBottomNav:!1}),[g]);K(E);const{fetch:V,loading:v}=Y(),{fetch:w,loading:j}=$();async function P(o){return s?.user_prediction?await w(T+`/${s.user_prediction.id}`,{prediction_entries:Object.entries(o).map(([i,l])=>({name:i,driver_id:l}))}).then(()=>{m("/"),d({type:"NOTIFY",payload:{id:new Date().getTime(),text:n("global.prediction-updated"),delay:5e3,type:"success"}})}):await V(D+`/${x}`+T,{prediction_entries:Object.entries(o).map(([i,l])=>({name:i,driver_id:l}))}).then(()=>{m("/"),d({type:"NOTIFY",payload:{id:new Date().getTime(),text:n("global.prediction-submited"),delay:5e3,type:"success"}})})}async function _(o){const i=await o();Object.keys(i).length<=0?(N(t+1),c(!1)):c(!0)}function F(){N(t-1)}const r=u.exports.useMemo(()=>h||v||j,[h,v,j]),I=u.exports.useMemo(()=>s?.user_prediction?s.user_prediction.prediction_entries.reduce((o,i)=>({...o,[i.name]:i.driver.id}),{}):{},[s]);return e.exports.jsxDEV("div",{className:"form-container",children:e.exports.jsxDEV(M,{validationSchema:q[t],validateOnChange:p,validateOnBlur:p,initialValues:I,onSubmit:P,enableReinitialize:!0,children:({handleSubmit:o,handleChange:i,values:l,errors:b,validateForm:S,dirty:O,submitCount:R})=>e.exports.jsxDEV(e.exports.Fragment,{children:[e.exports.jsxDEV(G,{when:O&&R<1,message:"You have unsaved changes, are you sure you want to leave?"},void 0,!1,{fileName:a,lineNumber:131,columnNumber:25},globalThis),e.exports.jsxDEV(U,{noValidate:!0,onSubmit:k=>{k.preventDefault(),o(),c(!0)},children:[t===0&&e.exports.jsxDEV(Q,{grandPrix:s,handleChange:i,errors:b,values:l,disabled:r},void 0,!1,{fileName:a,lineNumber:141,columnNumber:33},globalThis),t===1&&e.exports.jsxDEV(z,{grandPrix:s,handleChange:i,errors:b,values:l,disabled:r},void 0,!1,{fileName:a,lineNumber:150,columnNumber:33},globalThis),t===2&&e.exports.jsxDEV(H,{grandPrix:s,handleChange:i,errors:b,values:l,disabled:r},void 0,!1,{fileName:a,lineNumber:159,columnNumber:33},globalThis),e.exports.jsxDEV("div",{className:"d-flex py-3 w-10 position-sticky bg-white gap-4",style:{bottom:0},children:[t!==0&&e.exports.jsxDEV(f,{onClick:F,variant:"outline-primary",type:"button",className:"col-xs text-nowrap",disabled:r,children:[e.exports.jsxDEV("i",{className:"fas fa-arrow-left"},void 0,!1,{fileName:a,lineNumber:177,columnNumber:41},globalThis),e.exports.jsxDEV("span",{className:"ms-3",children:n("global.back")},void 0,!1,{fileName:a,lineNumber:178,columnNumber:41},globalThis)]},void 0,!0,{fileName:a,lineNumber:170,columnNumber:37},globalThis),t<2&&e.exports.jsxDEV(f,{onClick:()=>_(S),variant:"primary",type:"button",className:"col text-nowrap",disabled:r,children:[e.exports.jsxDEV("span",{className:"me-3",children:n("global.next")},void 0,!1,{fileName:a,lineNumber:189,columnNumber:41},globalThis),e.exports.jsxDEV("i",{className:"fas fa-arrow-right"},void 0,!1,{fileName:a,lineNumber:190,columnNumber:41},globalThis)]},void 0,!0,{fileName:a,lineNumber:182,columnNumber:37},globalThis),t===2&&e.exports.jsxDEV(f,{variant:"primary",type:"submit",className:"col",disabled:r,children:[e.exports.jsxDEV("span",{className:"me-3",children:n("global.save")},void 0,!1,{fileName:a,lineNumber:195,columnNumber:41},globalThis),e.exports.jsxDEV("i",{className:"fas fa-save"},void 0,!1,{fileName:a,lineNumber:196,columnNumber:41},globalThis)]},void 0,!0,{fileName:a,lineNumber:194,columnNumber:37},globalThis)]},void 0,!0,{fileName:a,lineNumber:168,columnNumber:29},globalThis)]},void 0,!0,{fileName:a,lineNumber:132,columnNumber:25},globalThis)]},void 0,!0)},void 0,!1,{fileName:a,lineNumber:121,columnNumber:13},globalThis)},void 0,!1,{fileName:a,lineNumber:120,columnNumber:9},globalThis)};export{re as default};
