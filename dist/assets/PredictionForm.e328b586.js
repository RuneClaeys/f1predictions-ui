import{o as B,R as j,v as A,u as C,r as n,j as e,P as G}from"./vendor.a19fa2bd.js";import{u as $,a as M,F as Q,v as Y,Q as q,R as z,E as H}from"./ExtraForm.8ed0aeef.js";import{F as U}from"./Form.c26ec606.js";import{B as b}from"./Button.23f59a48.js";import{a as X,u as J,b as D,c as E}from"./index.bfc473cf.js";import{u as K}from"./useNavbar.37856757.js";import"./warning.b33cdbd2.js";import"./Col.1b6e75ae.js";var a="C:\\Users\\runec\\Documents\\Projects\\f1predictions-ui\\src\\pages\\PredictionForm.jsx";const te=()=>{const{t:m}=B(),[f,u]=j.useState(!1),[i,N]=j.useState(0),{id:p}=A(),{push:c,goBack:x}=C(),{dispatch:y}=X(),{data:o,loading:h}=J(`${D}/${p}`);n.exports.useEffect(()=>{o&&new Date(o.qualifying_start_timestamp)<new Date&&(y({type:"NOTIFY",payload:{id:new Date().getTime(),text:"Grand Prix has already passed",delay:5e3,type:"danger"}}),c("/"))},[o]);const V=n.exports.useMemo(()=>({leftAction:x,leftActionIcon:"fa-arrow-left",showBottomNav:!1}),[x]);K(V);const{fetch:T,loading:v}=$(),{fetch:P,loading:g}=M();async function w(t){return o?.user_prediction?await P(E+`/${o.user_prediction.id}`,{result_entries:Object.entries(t).map(([s,r])=>({name:s,driver_id:r}))}).then(()=>c("/")):await T(D+`/${p}`+E,{prediction_entries:Object.entries(t).map(([s,r])=>({name:s,driver_id:r}))}).then(()=>c("/"))}async function _(t){const s=await t();Object.keys(s).length<=0?(N(i+1),u(!1)):u(!0)}function F(){N(i-1)}const l=n.exports.useMemo(()=>h||v||g,[h,v,g]),S=n.exports.useMemo(()=>o?.user_prediction?o.user_prediction.prediction_entries.reduce((t,s)=>({...t,[s.name]:s.driver.id}),{}):{},[o]);return e.exports.jsxDEV("div",{className:"form-container",children:e.exports.jsxDEV(Q,{validationSchema:Y[i],validateOnChange:f,validateOnBlur:f,initialValues:S,onSubmit:w,enableReinitialize:!0,children:({handleSubmit:t,handleChange:s,values:r,errors:d,validateForm:I,dirty:R,submitCount:k})=>e.exports.jsxDEV(e.exports.Fragment,{children:[e.exports.jsxDEV(G,{when:R&&k<1,message:"You have unsaved changes, are you sure you want to leave?"},void 0,!1,{fileName:a,lineNumber:105,columnNumber:19},globalThis),e.exports.jsxDEV(U,{noValidate:!0,onSubmit:O=>{O.preventDefault(),t(),u(!0)},children:[i===0&&e.exports.jsxDEV(q,{handleChange:s,errors:d,values:r,disabled:l},void 0,!1,{fileName:a,lineNumber:114,columnNumber:42},globalThis),i===1&&e.exports.jsxDEV(z,{handleChange:s,errors:d,values:r,disabled:l},void 0,!1,{fileName:a,lineNumber:115,columnNumber:42},globalThis),i===2&&e.exports.jsxDEV(H,{handleChange:s,errors:d,values:r,disabled:l},void 0,!1,{fileName:a,lineNumber:116,columnNumber:42},globalThis),e.exports.jsxDEV("div",{className:"d-flex py-3 w-10 position-sticky bg-white gap-4",style:{bottom:0},children:[i!==0&&e.exports.jsxDEV(b,{onClick:F,variant:"outline-primary",type:"button",className:"col-xs text-nowrap",disabled:l,children:[e.exports.jsxDEV("i",{className:"fas fa-arrow-left"},void 0,!1,{fileName:a,lineNumber:127,columnNumber:31},globalThis),e.exports.jsxDEV("span",{className:"ms-3",children:m("global.back")},void 0,!1,{fileName:a,lineNumber:128,columnNumber:31},globalThis)]},void 0,!0,{fileName:a,lineNumber:120,columnNumber:28},globalThis),i<2&&e.exports.jsxDEV(b,{onClick:()=>_(I),variant:"primary",type:"button",className:"col text-nowrap",disabled:l,children:[e.exports.jsxDEV("span",{className:"me-3",children:m("global.next")},void 0,!1,{fileName:a,lineNumber:139,columnNumber:31},globalThis),e.exports.jsxDEV("i",{className:"fas fa-arrow-right"},void 0,!1,{fileName:a,lineNumber:140,columnNumber:31},globalThis)]},void 0,!0,{fileName:a,lineNumber:132,columnNumber:28},globalThis),i===2&&e.exports.jsxDEV(b,{variant:"primary",type:"submit",className:"col",disabled:l,children:[e.exports.jsxDEV("span",{className:"me-3",children:m("global.save")},void 0,!1,{fileName:a,lineNumber:145,columnNumber:31},globalThis),e.exports.jsxDEV("i",{className:"fas fa-save"},void 0,!1,{fileName:a,lineNumber:146,columnNumber:31},globalThis)]},void 0,!0,{fileName:a,lineNumber:144,columnNumber:28},globalThis)]},void 0,!0,{fileName:a,lineNumber:118,columnNumber:22},globalThis)]},void 0,!0,{fileName:a,lineNumber:106,columnNumber:19},globalThis)]},void 0,!0)},void 0,!1,{fileName:a,lineNumber:95,columnNumber:10},globalThis)},void 0,!1,{fileName:a,lineNumber:94,columnNumber:7},globalThis)};export{te as default};
